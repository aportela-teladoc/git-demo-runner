version: 0.2

env:
  variables:
    ANDROID_TOOLS_FILENAME: "commandlinetools-linux-8512546_latest.zip"
    ANDROID_SDK_ROOT: "/usr/local/android-sdk-linux"
    ANDROID_CMDLINE_TOOLS: "$ANDROID_SDK_ROOT/cmdline-tools/latest"
    ANDROID_PLATFORM_TOOLS: "$ANDROID_SDK_ROOT/platform-tools"

phases:
  build:
    commands:
      - echo Accept Licences on `date`
      - wget https://dl.google.com/android/repository/$ANDROID_TOOLS_FILENAME -P ~ > /dev/null
      - unzip ~/$ANDROID_TOOLS_FILENAME -d ~ > /dev/null 2>&1
      - mkdir -p $ANDROID_CMDLINE_TOOLS
      - mv ~/cmdline-tools $ANDROID_CMDLINE_TOOLS/latest
      - export PATH=$PATH:$ANDROID_CMDLINE_TOOLS/latest:$ANDROID_PLATFORM_TOOLS
      - yes | sdkmanager --licenses > /dev/null
      - sdkmanager "platform-tools" "platforms;android-31" "build-tools;31.0.0" > /dev/null
      - echo Start gradle tasks on `date`
      - chmod +x ./gradlew
      - ./gradlew assembleDebug
      - ./gradlew testDebugUnitTest

cache:
  paths:
    - '/root/.gradle/caches/**/*'
    - '/root/.gradle/wrapper/**/*'
    - '$HOME/.gradle/caches'

artifacts:
  files:
    - 'app/build/outputs/**/*.apk'
  discard-paths: yes
